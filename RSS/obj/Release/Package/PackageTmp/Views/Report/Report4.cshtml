@model ConnectionLibrary.Model.Result
@{
    ViewBag.Title = "Report4";
    Layout = "~/Views/Shared/_LayoutPage.cshtml";
}

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">Reports</h1>
                </div>
                <!-- /.col -->
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="@Url.Action("Dashboard", "Master")">Home</a></li>
                        <li class="breadcrumb-item active">Reports</li>
                    </ol>
                </div>
                <!-- /.col -->
            </div>
            <!-- /.row -->
        </div>
        <!-- /.container-fluid -->
    </div>
    <section class="content">
        <div class="container-fluid">
            <!-- SELECT2 EXAMPLE -->

            <div class="card card-info">

                <div class="card-header py-1">

                    <div class="form-group mb-0 float-right row">
                        <div class="col-md-5">
                            <div class="row">
                                <label for="inputEmail3" class="col-sm-4 text-right col-form-label">ભાગ: </label>
                                <div class="col-sm-8">
                                    @Html.DropDownListFor(x => Model.BhagID, new SelectList(Model.ListBhag, "BhagID", "Bhag"), htmlAttributes: new { @class = "form-control", id = "drpBhag" })
                                </div>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="row">
                                <label for="inputEmail3" class="col-sm-3 text-right col-form-label">માસ:</label>
                                <div class="col-sm-9">
                                    @Html.DropDownListFor(x => Model.SearchMonthID, new SelectList(Model.ListMonth, "MonthID", "Month"), htmlAttributes: new { @class = "form-control", id = "drpMonth" })
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-light " id="btnExport" style="display:none;">
                            <i class="text-dark fa-download fa"></i>
                            <input type="hidden" name="GridHtml" />
                        </button>
                        @*   <a class="btn btn-light " id="btnExport">
                                <i class="text-dark fa-download fa"></i>
                                
                            </a>*@
                    </div>

                </div>

                <form action="@Url.Action("Export", "Report")" method="post">
                    <div class="card-body" id="fulldiv">
                        <div class="row">
                            <div class="col-md-12 mb-1">
                                <h5 class="text-center" style="text-align:center; font-size:20px; line-height:23px; font-family: 'Mukta Vaani', sans-serif;" id="bhagWiseLabel"></h5>
                                <h5 class="text-center" style="text-align:center; font-size:20px; line-height:23px; font-family: 'Mukta Vaani', sans-serif;" id="monthLabel"></h5>
                            </div>
                        </div>
                        <div id="divreport4" class="card card-info" style="margin-bottom:25px !important;">
                            <!-- <div class="card-header">
                            <h3 class="card-title">વિભાગ</h3>
                            <div class="card-tools">
                                <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                            </div>
                        </div> -->
                            <div class="card-body p-0">
                                <div class="table-responsive" id="divListing">
                                    @Html.Partial("~/Views/Shared/Partial/Reports/_Report4List.cshtml", Model)
                                </div>
                            </div>
                        </div>

                        <div id="divreport5" class="card card-info" style="margin-bottom:550px !important">
                            <!-- <div class="card-header">
                            <h3 class="card-title">વિભાગ</h3>
                            <div class="card-tools">
                                <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                            </div>
                        </div> -->
                            <div class="card-body p-0">
                                <div class="table-responsive" id="divR2Listing">
                                    @Html.Partial("~/Views/Shared/Partial/Reports/_Report5List.cshtml", Model)
                                </div>
                            </div>
                        </div>

                        <div id="divreport6" class="card card-info" style="margin-bottom:25px !important">
                            <!-- <div class="card-header">
                            <h3 class="card-title">વિભાગ</h3>
                            <div class="card-tools">
                                <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                            </div>
                        </div> -->
                            <div class="card-body p-0">
                                <div class="table-responsive" id="divR3Listing">
                                    @Html.Partial("~/Views/Shared/Partial/Reports/_Report6List.cshtml", Model)
                                </div>
                            </div>
                        </div>

                        <div id="divreport7" class="card card-info" style="margin-bottom:750px !important">
                            <!-- <div class="card-header">
                            <h3 class="card-title">વિભાગ</h3>
                            <div class="card-tools">
                                <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                            </div>
                        </div> -->
                            <div class="card-body p-0">
                                <div class="table-responsive" id="divR4Listing">
                                    @Html.Partial("~/Views/Shared/Partial/Reports/_Report7List.cshtml", Model)
                                </div>
                            </div>
                        </div>

                        <div id="divreport8" class="card card-info" style="margin-bottom:25px !important">
                            <div class="card-header">
                                <h3 class="card-title">પહેલો બુધવાર - નગર વિષય સહ બેઠક</h3>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive" id="divR5Listing">
                                    @Html.Partial("~/Views/Shared/Partial/Reports/_Report8List.cshtml", Model)


                                </div>
                            </div>
                        </div>

                        <div id="divreport9" class="card card-info" style="margin-bottom:650px !important">
                            <div class="card-header">
                                <h3 class="card-title">ત્રીજો બુધવાર -વસ્તી સહ બેઠક</h3>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive" id="divR6Listing">
                                    @Html.Partial("~/Views/Shared/Partial/Reports/_Report9List.cshtml", Model)
                                </div>
                            </div>
                        </div>

                        <div id="divreport10" class="card card-info" style="margin-bottom:25px !important">
                            <div class="card-body p-0">
                                <div class="table-responsive" id="divR7Listing">
                                    @Html.Partial("~/Views/Shared/Partial/Reports/_Report10List.cshtml", Model)
                                </div>
                            </div>
                        </div>

                        <div id="divreport11" class="card card-info" style="margin-bottom:25px !important">
                            <div class="card-body p-0">
                                <div class="table-responsive" id="divR8Listing">
                                    @Html.Partial("~/Views/Shared/Partial/Reports/_Report11List.cshtml", Model)
                                </div>
                            </div>
                        </div>

                        <div class="card card-info">
                            <div class="card-body p-0">
                                <div class="table-responsive" id="divR9Listing">
                                    @Html.Partial("~/Views/Shared/Partial/Reports/_Report12List.cshtml", Model)
                                </div>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" name="GridHtml" id="hdnGridHtml" />
                    <input type="hidden" name="Month" id="hdnMonthID" />
                    <input type="hidden" name="Bhag" id="hdnBhagID" />
                </form>
            </div>
        </div>
        <!-- /.container-fluid -->
    </section>
</div>
@section scripts
{
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("a").filter(".nav-link active").removeClass("nav-link active");

            $("#Reports").addClass("nav-link active");
            $("#report4").addClass("nav-link active");
            $("li").filter(".nav-item menu-open").removeClass("nav-item menu-open");
            $("#Reportsli").addClass("nav-item menu-open");

            $("#monthLabel").css("display", "none");
            $("#bhagWiseLabel").css("display", "none");

        });

        $('#drpMonth').change(function () {

            //$('#drpMonth').val(this.checked);
            $.ajax({
                type: "GET",
                url: "/Report/Report4LazyLoad",
                data: { MonthID: $('#drpMonth').val(), BhagID: $('#drpBhag').val() },
                timeout: 600000,
                beforeSend: function () {
                    $('#milan').css("display", 'block');
                },
                success: function (data) {
                    $("#divListing").html('');
                    $("#divListing").html(data.R1);
                    $("#divR2Listing").html('');
                    $("#divR2Listing").html(data.R2);
                    $("#divR3Listing").html('');
                    $("#divR3Listing").html(data.R3);
                    $("#divR4Listing").html('');
                    $("#divR4Listing").html(data.R4);
                    $("#divR5Listing").html('');
                    $("#divR5Listing").html(data.R5);
                    $("#divR6Listing").html('');
                    $("#divR6Listing").html(data.R6);
                    $("#divR7Listing").html('');
                    $("#divR7Listing").html(data.R7);
                    $("#divR8Listing").html('');
                    $("#divR8Listing").html(data.R8);
                    $("#divR9Listing").html('');
                    $("#divR9Listing").html(data.R9);


                    $("#monthLabel").html($('#drpMonth').find(":selected").text() + " માસનું વૃત વિવરણ");
                    $("#bhagWiseLabel").html("રાષ્ટ્રીય સ્વયંસેવક સંઘ - " + $('#drpBhag').find(":selected").text() + " ભાગ");
                    $("#monthLabel").css("display", "block");
                    $("#bhagWiseLabel").css("display", "block");
                    $("#btnExport").css("display", "block");
                },
                complete: function () {
                    $('#milan').css("display", 'none');
                },
            });

        });

        $('#drpBhag').change(function () {

            //$('#drpMonth').val(this.checked);
            $.ajax({
                type: "GET",
                url: "/Report/Report4LazyLoad",
                data: { MonthID: $('#drpMonth').val(), BhagID: $('#drpBhag').val() },
                timeout: 600000,
                beforeSend: function () {
                    $('#milan').css("display", 'block');
                },
                success: function (data) {
                    $("#divListing").html('');
                    $("#divListing").html(data.R1);
                    $("#divR2Listing").html('');
                    $("#divR2Listing").html(data.R2);
                    $("#divR3Listing").html('');
                    $("#divR3Listing").html(data.R3);
                    $("#divR4Listing").html('');
                    $("#divR4Listing").html(data.R4);
                    $("#divR5Listing").html('');
                    $("#divR5Listing").html(data.R5);
                    $("#divR6Listing").html('');
                    $("#divR6Listing").html(data.R6);
                    $("#divR7Listing").html('');
                    $("#divR7Listing").html(data.R7);
                    $("#divR8Listing").html('');
                    $("#divR8Listing").html(data.R8);
                    $("#divR9Listing").html('');
                    $("#divR9Listing").html(data.R9);

                    $("#monthLabel").html($('#drpMonth').find(":selected").text() + " માસનું વૃત વિવરણ");
                    $("#bhagWiseLabel").html("રાષ્ટ્રીય સ્વયંસેવક સંઘ - " + $('#drpBhag').find(":selected").text() + " ભાગ");
                    $("#monthLabel").css("display", "block");
                    $("#bhagWiseLabel").css("display", "block");
                    $("#btnExport").css("display", "block");
                },
                complete: function () {
                    $('#milan').css("display", 'none');
                },
            });

        });

        $("#btnExport").on("click", function () {
            //alert('hi');
            $("#hdnBhagID").val($('#drpBhag').find(":selected").text());
            $("#hdnMonthID").val($('#drpMonth').find(":selected").text());
            $("#hdnGridHtml").val($("#fulldiv").html());
            $('form').submit();
            //$("input[name='GridHtml']").val($("#fulldiv").html());
            //var html = $("#fulldiv").html();
            //var dataToSend = JSON.stringify({ 'GridHtml': html, MonthID: $('#drpMonth').val(), BhagID: $('#drpBhag').val() });
            //$.ajax({
            //    type: "POST",
            //    url: "/Report/Export",
            //    contentType: "application/json; charset=utf-8",
            //    //dataType: "json",
            //    data: dataToSend,

            //    timeout: 600000,
            //    beforeSend: function () {
            //        $('#milan').css("display", 'block');
            //    },

            //    success: function (data) {
            //        alert(data);
            //        var d = 'file:\\' + data.toString();
            //        alert(d);
            //        //var blob = new Blob([data], { type: "application/pdf" });
            //        var link = document.createElement("a");
            //        link.href = d;
            //        link.target = '_blank'
            //        link.download = "myFileName.pdf";
            //        link.click();
            //        //$('a#someID').attr({
            //        //    target: '_blank',
            //        //    href: 'http://localhost/directory/file.pdf'
            //        //});
            //    },
            //    complete: function () {
            //        $('#milan').css("display", 'none');
            //    },
            //});
        });
       

    </script>
}